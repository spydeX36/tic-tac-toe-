<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Blue Tic‑Tac‑Toe — Play vs Hard AI</title>
  <style>
    :root{
      --bg:#071b3a; /* deep blue */
      --card:#0f2a59;
      --accent:#3ea0ff; /* bright blue */
      --muted:#9bbbe6;
      --glass: rgba(255,255,255,0.04);
      --glass-2: rgba(255,255,255,0.02);
      font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#02102a);color:#eaf4ff}
    .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:32px}

    /* card */
    .app{width:100%;max-width:960px;background:linear-gradient(180deg,var(--card),#072144);border-radius:16px;box-shadow:0 10px 40px rgba(2,6,23,0.6);overflow:hidden;display:grid;grid-template-columns:380px 1fr}

    /* left: login / menu */
    .panel{padding:28px;background:linear-gradient(180deg,var(--glass),var(--glass-2));backdrop-filter: blur(6px)}
    .brand{display:flex;gap:12px;align-items:center;margin-bottom:18px}
    .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#5bd0ff);display:flex;align-items:center;justify-content:center;box-shadow:0 6px 18px rgba(62,160,255,0.18)}
    .logo svg{width:36px;height:36px}
    .title{font-size:18px;font-weight:700}
    .subtitle{font-size:13px;color:var(--muted)}

    .login-card{margin-top:12px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:14px;border-radius:12px}
    .btn{display:inline-flex;align-items:center;gap:10px;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);cursor:pointer;font-weight:600}
    .btn.google{background:linear-gradient(90deg,#fff,#f0f4ff);color:#111;padding:10px}
    .btn.guest{background:transparent;border:1px dashed rgba(255,255,255,0.06);color:var(--accent)}
    .small{font-size:12px;color:var(--muted)}

    .modes{display:flex;flex-direction:column;gap:10px;margin-top:18px}
    .mode{display:flex;align-items:center;justify-content:space-between;padding:10px;border-radius:10px;background:linear-gradient(180deg,rgba(255,255,255,0.01),transparent);border:1px solid rgba(255,255,255,0.02)}
    .mode h4{margin:0;font-size:14px}
    .mode p{margin:0;font-size:12px;color:var(--muted)}

    /* right: game */
    .play-area{padding:28px;display:flex;flex-direction:column;gap:14px}
    .top-row{display:flex;align-items:center;justify-content:space-between}
    .score{display:flex;gap:12px;align-items:center}
    .chip{padding:8px 12px;border-radius:10px;background:linear-gradient(90deg,rgba(255,255,255,0.02),transparent);border:1px solid rgba(255,255,255,0.03)}

    .board{width:360px;height:360px;display:grid;grid-template-columns:repeat(3,1fr);gap:12px;background:linear-gradient(180deg,#072a4a,#04142b);padding:12px;border-radius:16px;align-self:center}
    .cell{display:flex;align-items:center;justify-content:center;font-size:64px;font-weight:800;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border-radius:12px;cursor:pointer;user-select:none;transition:transform .12s ease,background .12s}
    .cell:hover{transform:translateY(-4px)}

    .controls{display:flex;gap:10px;align-items:center;justify-content:center}
    .small-muted{font-size:13px;color:var(--muted)}

    /* responsive */
    @media (max-width:900px){.app{grid-template-columns:1fr}.panel{order:2}.play-area{order:1}}

    /* winner line animation */
    .win-line{position:absolute;pointer-events:none}

    /* footer */
    .footer{font-size:12px;color:var(--muted);text-align:center;margin-top:6px}

    /* simple form styles */
    .username{margin-top:12px;display:flex;gap:8px}
    .username input{flex:1;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}

    /* subtle micro-interactions */
    .ghost{opacity:0.6}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="app">
      <div class="panel">
        <div class="brand">
          <div class="logo" aria-hidden>
            <!-- simple X/O icon -->
            <svg viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect x="8" y="8" width="48" height="48" rx="10" fill="white" fill-opacity="0.06" />
              <path d="M20 20 L44 44 M44 20 L20 44" stroke="white" stroke-width="3" stroke-linecap="round" stroke-opacity="0.9"/>
            </svg>
          </div>
          <div>
            <div class="title">Blue Tic‑Tac‑Toe</div>
            <div class="subtitle">Clean UI · Hard AI · Guest + Google · Multiplayer</div>
          </div>
        </div>

        <div class="login-card">
          <div style="display:flex;gap:10px;align-items:center;justify-content:space-between">
            <div>
              <div class="small">Sign in to save stats</div>
              <div class="small-muted">Play instantly as Guest or connect with Google</div>
            </div>
            <div style="display:flex;flex-direction:column;gap:8px">
              <button class="btn google" id="googleBtn" title="Sign in with Google">
                <svg width="18" height="18" viewBox="0 0 533.5 544.3"><path fill="#4285f4" d="M533.5 278.4c0-17.4-1.6-34.1-4.6-50.3H272v95.1h147.1c-6.4 34.5-25.8 63.7-55 83.3l88.8 69.1c51.9-47.9 81.6-118.1 81.6-197.2z"/><path fill="#34a853" d="M272 544.3c73.5 0 135.4-24.4 180.6-66.2l-88.8-69.1c-24.7 16.6-56.3 26.4-91.8 26.4-70.6 0-130.4-47.6-151.8-111.6l-92.6 71.5c44.4 87.7 135.9 149 244.4 149z"/><path fill="#fbbc04" d="M120.2 327.6c-10.7-31.7-10.7-65.8 0-97.5L27.6 158.6C-12.8 236.5-12.8 322.7 27.6 400.6l92.6-73z"/><path fill="#ea4335" d="M272 107.7c39.9 0 75.8 13.7 104.1 40.5l78-78C407.4 24.3 341.5 0 272 0 163.5 0 72 61.3 27.6 148.9l92.6 71.5C141.6 155.3 201.4 107.7 272 107.7z"/></svg>
                <span>Sign in with Google</span>
              </button>
              <button class="btn guest" id="guestBtn">Continue as Guest</button>
            </div>
          </div>

          <div class="username">
            <input id="nameInput" placeholder="Enter display name (optional)" maxlength="20" />
            <button class="btn" id="saveName">Save</button>
          </div>

          <div class="modes">
            <div class="mode"><div><h4>Play vs Hard AI</h4><p>Minimax-based unbeatable AI</p></div><button class="btn" id="btnAI">Play vs AI</button></div>
            <div class="mode"><div><h4>Local Multiplayer</h4><p>Pass & Play on one device</p></div><button class="btn" id="btnLocal">Play Local</button></div>
            <div class="mode"><div><h4>Online Multiplayer</h4><p>Requires a server (placeholder client included)</p></div><button class="btn" id="btnOnline">Open Multiplayer</button></div>
          </div>

          <div class="footer">Tip: try starting second to test the AI's defense.</div>
        </div>
      </div>

      <div class="play-area">
        <div class="top-row">
          <div class="score">
            <div class="chip">You: <span id="playerMark">X</span></div>
            <div class="chip">AI: <span id="aiMark">O</span></div>
            <div class="chip">Mode: <span id="gameMode">Idle</span></div>
          </div>
          <div style="display:flex;gap:8px;align-items:center">
            <img id="avatar" src="" alt="avatar" style="width:36px;height:36px;border-radius:50%;display:none;border:2px solid rgba(255,255,255,0.2)"/>
            <button class="btn" id="logoutBtn" style="display:none">Logout</button>
            <button class="btn" id="resetBtn">Reset</button>
            <button class="btn" id="undoBtn">Undo</button>
          </div>
        </div>

        <div style="position:relative;display:flex;flex-direction:column;align-items:center;">
          <div class="board" id="board">
            <!-- 9 cells -->
            <div class="cell" data-i="0"></div>
            <div class="cell" data-i="1"></div>
            <div class="cell" data-i="2"></div>
            <div class="cell" data-i="3"></div>
            <div class="cell" data-i="4"></div>
            <div class="cell" data-i="5"></div>
            <div class="cell" data-i="6"></div>
            <div class="cell" data-i="7"></div>
            <div class="cell" data-i="8"></div>
          </div>
          <div class="controls" style="margin-top:14px">
            <div class="small-muted" id="status">Press a mode to begin</div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
// Simple Tic-Tac-Toe site script with hard AI (minimax), local multiplayer and placeholders for online & Google sign-in.
(() => {
  const boardEl = document.getElementById('board');
  const cells = Array.from(document.querySelectorAll('.cell'));
  const statusEl = document.getElementById('status');
  const playerMarkEl = document.getElementById('playerMark');
  const aiMarkEl = document.getElementById('aiMark');
  const gameModeEl = document.getElementById('gameMode');

  let board = Array(9).fill(null);
  let currentPlayer = 'X';
  let human = 'X';
  let ai = 'O';
  let mode = null; // 'ai', 'local', 'online'
  let history = [];

  const winningLines = [
    [0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]
  ];

  function render(){
    cells.forEach((c,i)=>{
      c.textContent = board[i]||'';
      c.classList.toggle('disabled', !!board[i]);
    });
  }

  function checkWinner(b){
    for(const line of winningLines){
      const [a,b1,c] = line;
      if(b[a] && b[a]===b[b1] && b[a]===b[c]) return {winner:b[a], line};
    }
    if(b.every(Boolean)) return {winner:'draw'};
    return null;
  }

  function setStatus(s){ statusEl.textContent = s; }

  function makeMove(i,mark){
    if(board[i]) return false;
    history.push(board.slice());
    board[i]=mark;
    render();
    const res = checkWinner(board);
    if(res){
      if(res.winner==='draw') setStatus('Draw — well played.');
      else setStatus(res.winner + ' wins!');
      mode = null; gameModeEl.textContent='Idle';
      return true;
    }
    return true;
  }

  // Minimax for hard AI
  function minimax(newBoard, player){
    const win = checkWinner(newBoard);
    if(win){
      if(win.winner===ai) return {score: 10};
      else if(win.winner===human) return {score: -10};
      else return {score: 0};
    }
    const avail = newBoard.map((v,i)=>v?null:i).filter(x=>x!==null);
    const moves = [];
    for(const i of avail){
      const move = {};
      move.index = i;
      newBoard[i] = player;
      if(player===ai){
        const result = minimax(newBoard,human);
        move.score = result.score;
      } else {
        const result = minimax(newBoard,ai);
        move.score = result.score;
      }
      newBoard[i] = null;
      moves.push(move);
    }
    // choose best
    let bestMove;
    if(player===ai){
      let bestScore = -Infinity;
      for(const m of moves){ if(m.score>bestScore){bestScore=m.score;bestMove=m;} }
    } else {
      let bestScore = Infinity;
      for(const m of moves){ if(m.score<bestScore){bestScore=m.score;bestMove=m;} }
    }
    return bestMove;
  }

  // UI actions
  cells.forEach(c=>c.addEventListener('click',()=>{
    if(!mode) return setStatus('Choose a mode first.');
    const i = Number(c.dataset.i);
    if(mode==='ai'){
      if(board[i]) return;
      if(currentPlayer!==human) return;
      makeMove(i,human);
      currentPlayer = ai;
      const res = checkWinner(board);
      if(res) return;
      // AI move
      setTimeout(()=>{
        const best = minimax(board.slice(), ai);
        makeMove(best.index, ai);
        currentPlayer = human;
      }, 200);
    } else if(mode==='local'){
      if(board[i]) return;
      makeMove(i,currentPlayer);
      currentPlayer = currentPlayer==='X'?'O':'X';
      setStatus("Next: " + currentPlayer);
    }
  }));

  document.getElementById('btnAI').addEventListener('click',()=>{
    resetBoard();
    mode='ai'; gameModeEl.textContent='Vs Hard AI';
    human = 'X'; ai='O'; currentPlayer = 'X';
    playerMarkEl.textContent = human; aiMarkEl.textContent=ai;
    setStatus('Your turn as ' + human);
  });

  document.getElementById('btnLocal').addEventListener('click',()=>{
    resetBoard();
    mode='local'; gameModeEl.textContent='Local Multiplayer';
    currentPlayer='X'; setStatus('Next: X');
  });

  document.getElementById('resetBtn').addEventListener('click',resetBoard);
  document.getElementById('undoBtn').addEventListener('click',()=>{
    if(history.length===0) return setStatus('Nothing to undo');
    board = history.pop(); render(); setStatus('Undid last move');
  });

  function resetBoard(){ board = Array(9).fill(null); history=[]; render(); setStatus('Board cleared'); }

  // name and sign-in (mock)
  document.getElementById('guestBtn').addEventListener('click',()=>{
    const name = document.getElementById('nameInput').value || 'Guest';
    setStatus('Signed in as ' + name + ' (guest)');
  });
  // ✅ REAL GOOGLE SIGN‑IN WITH FIREBASE AUTH (EXAMPLE)
  // 1) Add your Firebase project config below
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    appId: "YOUR_APP_ID"
  };

  // 2) Load Firebase via CDN (already included at page load using dynamic import)
  let auth, provider;
  async function initFirebase(){
    if(auth) return;
    const { initializeApp } = await import("https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js");
    const { getAuth, GoogleAuthProvider, signInWithPopup } = await import("https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js");
    const app = initializeApp(firebaseConfig);
    auth = getAuth(app);
    provider = new GoogleAuthProvider();
    window.__signInWithPopup = (a,p)=>signInWithPopup(a,p);
  }

  document.getElementById('googleBtn').addEventListener('click', async () => {
    try{
      await initFirebase();
      const result = await window.__signInWithPopup(auth, provider);
      const user = result.user;
      setStatus('Signed in as ' + (user.displayName || user.email));
      if(user.displayName) document.getElementById('nameInput').value = user.displayName;
    }catch(err){
      console.error(err);
      alert('Google sign-in failed. Check Firebase config and allowed domains.');
    }
  });
  document.getElementById('saveName').addEventListener('click',()=>{
    const n = document.getElementById('nameInput').value || 'Guest';
    setStatus('Name saved: ' + n);
  });

  // ✅ FIRESTORE + STATS + AUTH STATE (EXAMPLE)
  let db, currentUser = null;

  async function initFirestore(){
    if(db) return;
    const { getFirestore, doc, getDoc, setDoc, updateDoc, increment } = await import("https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js");
    const { onAuthStateChanged, signOut } = await import("https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js");
    window.__firestore = { getFirestore, doc, getDoc, setDoc, updateDoc, increment };
    window.__signOut = signOut;
    db = getFirestore();

    onAuthStateChanged(auth, async (user)=>{
      currentUser = user || null;
      const avatar = document.getElementById('avatar');
      const logoutBtn = document.getElementById('logoutBtn');

      if(user){
        avatar.src = user.photoURL || '';
        avatar.style.display = 'block';
        logoutBtn.style.display = 'inline-flex';
        setStatus('Logged in: ' + (user.displayName || user.email));

        // Create user doc if not exists
        const ref = window.__firestore.doc(db,'users',user.uid);
        const snap = await window.__firestore.getDoc(ref);
        if(!snap.exists()){
          await window.__firestore.setDoc(ref,{ wins:0, losses:0, draws:0, name:user.displayName || 'Player' });
        }
      } else {
        avatar.style.display = 'none';
        logoutBtn.style.display = 'none';
      }
    });
  }

  document.getElementById('logoutBtn').addEventListener('click', async ()=>{
    if(!auth) return;
    await window.__signOut(auth);
    setStatus('Logged out');
  });

  // ✅ SAVE WIN/LOSS TO FIRESTORE
  async function saveResultToFirestore(result){
    if(!currentUser) return; // only save for logged-in users
    await initFirestore();
    const ref = window.__firestore.doc(db,'users',currentUser.uid);

    if(result === human){
      await window.__firestore.updateDoc(ref,{ wins: window.__firestore.increment(1) });
    }else if(result === ai){
      await window.__firestore.updateDoc(ref,{ losses: window.__firestore.increment(1) });
    }else if(result === 'draw'){
      await window.__firestore.updateDoc(ref,{ draws: window.__firestore.increment(1) });
    }
  }

  // ONLINE MULTIPLAYER placeholder
  document.getElementById('btnOnline').addEventListener('click', async ()=>{
    if(!currentUser){
      alert('Please sign in with Google to use online multiplayer.');
      return;
    }
    mode='online'; gameModeEl.textContent='Online (Protected)';
    setStatus('Online multiplayer secured with Firebase UID: ' + currentUser.uid);

    // ✅ PLAYER UID IS NOW AVAILABLE FOR SERVER
    // Example payload to send to your WebSocket server:
    // { type:'join', uid: currentUser.uid, name: currentUser.displayName }

    alert('Online mode is now PROTECTED by Firebase Auth. Your UID is used for matchmaking.');
  });
      return;
    }
    mode='online'; gameModeEl.textContent='Online (Protected)';
    setStatus('Online multiplayer secured with Firebase UID: ' + currentUser.uid);

    // ✅ PLAYER UID IS NOW AVAILABLE FOR SERVER
    // Example payload to send to your WebSocket server:
    // { type:'join', uid: currentUser.uid, name: currentUser.displayName }

    alert('Online mode is now PROTECTED by Firebase Auth.
Your UID is sent to the server for secure matchmaking.');
  });

  // initial render
  render();
})();
</script>

<!-- NOTES (developer):
  - This single-file demo implements a hard AI (minimax), local pass-and-play multiplayer and a mock login UI.
  - To integrate real Google sign-in: use Firebase Authentication (Email/Google) or Google OAuth2.0. Add the provider code and replace the placeholder click handler.
  - To enable online multiplayer: create a lightweight WebSocket server that broadcasts moves between two clients. The client sends JSON like {type:'move',index:4,mark:'X'} and listens for remote moves to update the board.
  - You can copy this file to "tic-tac-toe.html" and open in a modern browser.
-->
</body>
</html>
